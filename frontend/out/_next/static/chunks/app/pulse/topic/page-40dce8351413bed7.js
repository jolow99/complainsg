(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[476],{1703:(e,t,a)=>{"use strict";a.d(t,{IF:()=>c,Sk:()=>l,Y$:()=>i,e2:()=>m,gb:()=>o,iU:()=>d,jj:()=>u,lV:()=>n});var s=a(8915),r=a(5317);let l=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"ryan",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"123",l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};try{var c;let n=(0,r.rJ)(s.db,"threads"),d=(0,r.P)(n,(0,r._M)("userID","==",t),(0,r._M)("threadID","==",a)),i=null!=(c=await (0,r.GG)(d))?c:[],o=null;if(!i.empty&&i.docs[0].exists()){let s={updatedAt:new Date,title:l.topic,userID:t,threadID:a,category:"feedback",headId:e.message.id,tags:[],topic:l.topic,location:l.location,summary:l.summary,quality:l.quality};o=i.docs[0].ref,await (0,r.mZ)(o,s)}else{let l={userID:t,threadID:a,localId:"",title:"",createdAt:new Date,updatedAt:new Date,category:"feedback",headId:e.message.id,tags:[],topic:null,location:null,summary:null,quality:0};o=(0,r.H9)(s.db,"threads",a),await (0,r.BN)(o,l)}let m=(0,r.rJ)(s.db,"threads",o.id,"messages"),u=await (0,r.GG)(m),h={id:e.message.id,parentId:e.parentId,content:e.message.content,role:e.message.role,metadata:e.message.metadata,createdAt:e.message.createdAt};await (0,r.gS)(m,h),console.log("✅ Saved ".concat(e.message.role," message to subcollection"),{messageIndex:u.size})}catch(t){console.error("❌ Error saving ".concat(e.message.role," message to DB:"),t)}},c=async e=>{let t=(0,r.rJ)(s.db,"threads"),a=(0,r.P)(t,(0,r._M)("userID","==",e));return(await (0,r.GG)(a)).docs.map(e=>e.data())},n=async e=>{let t=(0,r.rJ)(s.db,"threads",e,"messages"),a=(0,r.P)(t);return(await (0,r.GG)(a)).docs.map(e=>e.data())},d=async e=>{let t=(0,r.H9)(s.db,"threads",e);return(await (0,r.x7)(t)).data()},i=async e=>{let t=(0,r.rJ)(s.db,"threads"),a=(0,r.P)(t,(0,r._M)("topic","==",e));return(await (0,r.GG)(a)).docs.map(e=>e.data())},o=async()=>{let e=(0,r.rJ)(s.db,"topics"),t=(0,r.P)(e),a=await (0,r.GG)(t);return console.log("\uD83D\uDD0D DATABASE FUNCTION: topicsSnapshot =",a),a.docs.map(e=>e.data())},m=async e=>{let t=(0,r.rJ)(s.db,"topics"),a=(0,r.P)(t,(0,r._M)("topic","==",e)),l=await (0,r.GG)(a);return l.empty?null:l.docs[0].data()},u=async e=>{let t=(0,r.rJ)(s.db,"threads",e,"messages"),a=(0,r.P)(t);return(await (0,r.GG)(a)).docs.map(e=>e.data())}},2195:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>i});var s=a(5155),r=a(2115),l=a(5695),c=a(1703),n=a(8482);function d(e){let{topic:t,description:a,threadID:r,onClick:l}=e;return(0,s.jsx)(n.Zp,{className:"w-xl cursor-pointer hover:shadow-lg transition-shadow duration-200 hover:bg-gray-50",onClick:l,children:(0,s.jsxs)(n.aR,{className:"flex flex-col justify-around gap-6 py-6 pl-6",children:[(0,s.jsx)(n.ZB,{className:"text-3xl font-bold",children:t}),(0,s.jsx)(n.BT,{children:a})]})})}function i(){let[e,t]=(0,r.useState)([]),[a,c]=(0,r.useState)(null),[n,d]=(0,r.useState)(!0),i=(0,l.useRouter)();return(0,s.jsx)(r.Suspense,{fallback:(0,s.jsx)("div",{children:"Loading search parameters..."}),children:(0,s.jsx)(o,{threads:e,setThreads:t,topic:a,setTopic:c,loading:n,setLoading:d,router:i})})}function o(e){let{threads:t,setThreads:a,topic:n,setTopic:i,loading:o,setLoading:m,router:u}=e,h=(0,l.useSearchParams)();return((0,r.useEffect)(()=>{let e=async()=>{let e=h.get("topic");if(!e)return void console.error("No topic parameter found");console.log("\uD83D\uDD0D TOPIC PAGE: topicParam =",e),a(await (0,c.Y$)(e))};(async()=>{let e=h.get("topic");if(!e){console.error("No topic parameter found"),m(!1);return}try{let t=await (0,c.e2)(e);console.log("\uD83D\uDD0D TOPIC PAGE: topicData =",t),t&&i({topic:t.topic,summary:t.summary,imageURL:t.imageURL})}catch(e){console.error("Error fetching topic:",e)}finally{m(!1)}})(),e()},[]),o)?(0,s.jsx)("div",{className:"min-h-screen flex w-full items-center justify-center",children:(0,s.jsx)("div",{className:"text-lg",children:"Loading..."})}):n?(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 p-6",children:(0,s.jsx)("div",{className:"max-w-7xl mx-auto",children:(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 h-full",children:[(0,s.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-8 flex flex-col items-center justify-center space-y-6",children:[(0,s.jsxs)("div",{className:"text-center space-y-4",children:[(0,s.jsx)("h1",{className:"text-4xl font-bold text-gray-900 leading-tight",children:n.topic}),(0,s.jsx)("p",{className:"text-lg text-gray-600 max-w-md leading-relaxed",children:n.summary})]}),(0,s.jsx)("div",{className:"flex-shrink-0",children:(0,s.jsx)("img",{src:n.imageURL||"/Plane_Cuphead.png",alt:"Topic illustration",className:"w-64 h-64 object-contain drop-shadow-lg"})})]}),(0,s.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-8",children:[(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("h2",{className:"text-2xl font-semibold text-gray-900 mb-2",children:"Related Complaints"}),(0,s.jsxs)("p",{className:"text-gray-600",children:[(null==t?void 0:t.length)||0," complaint",(null==t?void 0:t.length)!==1?"s":""," found"]})]}),(0,s.jsx)("div",{className:"space-y-4 max-h-[600px] overflow-y-auto",children:t&&t.length>0?t.map(e=>(0,s.jsx)(d,{topic:e.topic||"",description:e.summary||"",threadID:e.threadID,onClick:()=>{var t;return t=e.threadID,void u.push("/pulse/topic/thread?threadId=".concat(t))}},e.threadID)):(0,s.jsxs)("div",{className:"text-center py-12 text-gray-500",children:[(0,s.jsx)("p",{className:"text-lg",children:"No complaints found for this topic yet."}),(0,s.jsx)("p",{className:"text-sm mt-2",children:"Be the first to report an issue!"})]})})]})]})})}):(0,s.jsx)("div",{className:"min-h-screen flex w-full items-center justify-center",children:(0,s.jsx)("div",{className:"text-lg",children:"Topic not found"})})}},3999:(e,t,a)=>{"use strict";a.d(t,{cn:()=>l});var s=a(2596),r=a(9688);function l(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,r.QP)((0,s.$)(t))}},4384:(e,t,a)=>{Promise.resolve().then(a.bind(a,2195))},8482:(e,t,a)=>{"use strict";a.d(t,{BT:()=>d,X9:()=>i,ZB:()=>n,Zp:()=>l,aR:()=>c});var s=a(5155);a(2115);var r=a(3999);function l(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"card",className:(0,r.cn)("bg-card text-card-foreground flex flex-row justify-between rounded-xl border shadow-sm",t),...a})}function c(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"card-header",className:(0,r.cn)("flex flex-col gap-6",t),...a})}function n(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"card-title",className:(0,r.cn)("leading-none font-semibold",t),...a})}function d(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"card-description",className:(0,r.cn)("text-muted-foreground text-sm",t),...a})}function i(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"card-action",className:(0,r.cn)("col-start-2 row-span-2 row-start-1 self-start justify-self-end",t),...a})}},8915:(e,t,a)=>{"use strict";a.d(t,{db:()=>n});var s=a(3915),r=a(1906),l=a(5317);let c=(0,s.Dk)().length?(0,s.Sx)():(0,s.Wp)({apiKey:"AIzaSyCx76hPfuiJY5WXVn0RBCozB-WyD_Z0gL0",authDomain:"complainsg-b0b10.firebaseapp.com",projectId:"complainsg-b0b10",storageBucket:"complainsg-b0b10.firebasestorage.app",messagingSenderId:"314044733634",appId:"1:314044733634:web:367d7154e09e6ef1ed435b",measurementId:"G-ZED4RQZEEX"});(0,r.TT)().then(e=>e?(0,r.P5)(c):null);let n=(0,l.aU)(c)}},e=>{e.O(0,[135,511,277,441,964,358],()=>e(e.s=4384)),_N_E=e.O()}]);
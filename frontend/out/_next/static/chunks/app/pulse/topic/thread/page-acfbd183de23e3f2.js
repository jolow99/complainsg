(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[985],{1703:(e,a,t)=>{"use strict";t.d(a,{IF:()=>n,Sk:()=>d,Y$:()=>i,e2:()=>m,gb:()=>o,iU:()=>l,jj:()=>g,lV:()=>c});var s=t(8915),r=t(5317);let d=async function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"ryan",t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"123",d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};try{var n;let c=(0,r.rJ)(s.db,"threads"),l=(0,r.P)(c,(0,r._M)("userID","==",a),(0,r._M)("threadID","==",t)),i=null!=(n=await (0,r.GG)(l))?n:[],o=null;if(!i.empty&&i.docs[0].exists()){let s={updatedAt:new Date,title:d.topic,userID:a,threadID:t,category:"feedback",headId:e.message.id,tags:[],topic:d.topic,location:d.location,summary:d.summary,quality:d.quality};o=i.docs[0].ref,await (0,r.mZ)(o,s)}else{let d={userID:a,threadID:t,localId:"",title:"",createdAt:new Date,updatedAt:new Date,category:"feedback",headId:e.message.id,tags:[],topic:null,location:null,summary:null,quality:0};o=(0,r.H9)(s.db,"threads",t),await (0,r.BN)(o,d)}let m=(0,r.rJ)(s.db,"threads",o.id,"messages"),g=await (0,r.GG)(m),h={id:e.message.id,parentId:e.parentId,content:e.message.content,role:e.message.role,metadata:e.message.metadata,createdAt:e.message.createdAt};await (0,r.gS)(m,h),console.log("✅ Saved ".concat(e.message.role," message to subcollection"),{messageIndex:g.size})}catch(a){console.error("❌ Error saving ".concat(e.message.role," message to DB:"),a)}},n=async e=>{let a=(0,r.rJ)(s.db,"threads"),t=(0,r.P)(a,(0,r._M)("userID","==",e));return(await (0,r.GG)(t)).docs.map(e=>e.data())},c=async e=>{let a=(0,r.rJ)(s.db,"threads",e,"messages"),t=(0,r.P)(a);return(await (0,r.GG)(t)).docs.map(e=>e.data())},l=async e=>{let a=(0,r.H9)(s.db,"threads",e);return(await (0,r.x7)(a)).data()},i=async e=>{let a=(0,r.rJ)(s.db,"threads"),t=(0,r.P)(a,(0,r._M)("topic","==",e));return(await (0,r.GG)(t)).docs.map(e=>e.data())},o=async()=>{let e=(0,r.rJ)(s.db,"topics"),a=(0,r.P)(e),t=await (0,r.GG)(a);return console.log("\uD83D\uDD0D DATABASE FUNCTION: topicsSnapshot =",t),t.docs.map(e=>e.data())},m=async e=>{let a=(0,r.rJ)(s.db,"topics"),t=(0,r.P)(a,(0,r._M)("topic","==",e)),d=await (0,r.GG)(t);return d.empty?null:d.docs[0].data()},g=async e=>{let a=(0,r.rJ)(s.db,"threads",e,"messages"),t=(0,r.P)(a);return(await (0,r.GG)(t)).docs.map(e=>e.data())}},4165:(e,a,t)=>{Promise.resolve().then(t.bind(t,8736))},8736:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>c});var s=t(5155),r=t(2115),d=t(5695),n=t(1703);function c(){let[e,a]=(0,r.useState)([]),[t,d]=(0,r.useState)(!0),[n,c]=(0,r.useState)(null);return(0,s.jsx)(r.Suspense,{fallback:(0,s.jsx)("div",{children:"Loading search parameters..."}),children:(0,s.jsx)(l,{loading:t,error:n,setLoading:d,setError:c,messages:e,setMessages:a})})}function l(e){let{loading:a,error:t,setLoading:c,setError:l,messages:i,setMessages:o}=e,m=(0,d.useSearchParams)().get("threadId");return((0,r.useEffect)(()=>{(async()=>{if(!m){l("No thread ID provided"),c(!1);return}try{let e=(await (0,n.jj)(m)).map(e=>({content:e.content,createdAt:e.createdAt,id:e.id,metadata:e.metadata,parentId:e.parentId,role:e.role})).sort((e,a)=>e.createdAt&&a.createdAt?new Date(1e3*e.createdAt.seconds).getTime()-new Date(1e3*a.createdAt.seconds).getTime():0);o(e)}catch(e){console.error("Error fetching messages:",e),l("Failed to load messages")}finally{c(!1)}})()},[m]),a)?(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,s.jsx)("div",{className:"text-lg text-gray-600",children:"Loading conversation..."})}):t?(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-lg text-red-600 mb-2",children:"Error"}),(0,s.jsx)("div",{className:"text-gray-600",children:t})]})}):(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,s.jsxs)("div",{className:"max-w-4xl mx-auto px-4",children:[(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Conversation Thread"}),(0,s.jsxs)("p",{className:"text-gray-600",children:[i.length," message",1!==i.length?"s":""," in this conversation"]})]}),(0,s.jsx)("div",{className:"space-y-6",children:i.map((e,a)=>(0,s.jsx)("div",{className:"flex ".concat("user"===e.role?"justify-end":"justify-start"),children:(0,s.jsxs)("div",{className:"max-w-3xl rounded-2xl px-6 py-4 ".concat("user"===e.role?"bg-blue-600 text-white ml-12":"bg-white text-gray-900 mr-12 shadow-sm border border-gray-200"),children:[(0,s.jsxs)("div",{className:"flex items-center mb-2",children:[(0,s.jsx)("span",{className:"text-sm font-medium opacity-75",children:"user"===e.role?"You":"Assistant"}),e.createdAt&&(0,s.jsx)("span",{className:"text-xs opacity-50 ml-2",children:new Date(1e3*e.createdAt.seconds).toLocaleString()})]}),(0,s.jsx)("div",{className:"prose prose-sm max-w-none",children:Array.isArray(e.content)?e.content.map((e,a)=>(0,s.jsx)("div",{children:"text"===e.type&&(0,s.jsx)("p",{className:"whitespace-pre-wrap leading-relaxed",children:e.text})},a)):(0,s.jsx)("p",{className:"whitespace-pre-wrap leading-relaxed",children:e.content})})]})},e.id||a))}),0===i.length&&(0,s.jsx)("div",{className:"text-center py-12 text-gray-500",children:(0,s.jsx)("p",{className:"text-lg",children:"No messages found in this thread."})})]})})}},8915:(e,a,t)=>{"use strict";t.d(a,{db:()=>c});var s=t(3915),r=t(1906),d=t(5317);let n=(0,s.Dk)().length?(0,s.Sx)():(0,s.Wp)({apiKey:"AIzaSyCx76hPfuiJY5WXVn0RBCozB-WyD_Z0gL0",authDomain:"complainsg-b0b10.firebaseapp.com",projectId:"complainsg-b0b10",storageBucket:"complainsg-b0b10.firebasestorage.app",messagingSenderId:"314044733634",appId:"1:314044733634:web:367d7154e09e6ef1ed435b",measurementId:"G-ZED4RQZEEX"});(0,r.TT)().then(e=>e?(0,r.P5)(n):null);let c=(0,d.aU)(n)}},e=>{e.O(0,[135,511,441,964,358],()=>e(e.s=4165)),_N_E=e.O()}]);